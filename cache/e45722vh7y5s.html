<!DOCTYPE html>
<html lang="was" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>opensim:banning_agents [Wizardry and Steamworks]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="opensim,banning_agents"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/opensearch.php" title="Wizardry and Steamworks"/>
<link rel="start" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/"/>
<link rel="contents" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents?do=index" title="Sitemap"/>
<link rel="manifest" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Changes" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/feed.php?mode=list&amp;ns=opensim"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/_export/xhtml/opensim/banning_agents"/>
<link rel="canonical" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"/>
<link rel="stylesheet" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/css.php?t=was&amp;tseed=24551d22639bdaeb736aec3dca86fd82"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='opensim';var JSINFO = {"plugin_imagemap_mldummy":"http:\/\/3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion\/_media\/wiki\/dokuwiki-128.png","isadmin":0,"isauth":0,"plugin_pdfjs":{"hide_download_button":0},"plugins":{"vshare":{"youtube":"youtube\\.com\/.*[&?]v=([a-z0-9_\\-]+)","vimeo":"vimeo\\.com\\\/(\\d+)","slideshare":"slideshare.*id=(\\d+)","dailymotion":"dailymotion\\.com\/video\/([a-z0-9]+)","archiveorg":"archive\\.org\/(?:embed|details)\/([a-zA-Z0-9_\\-]+)","soundcloud":"soundcloud\\.com\/([\\w-]+\/[\\w-]+)","niconico":"nicovideo\\.jp\/watch\/(sm[0-9]+)","bitchute":"bitchute\\.com\\\/video\\\/([a-zA-Z0-9_\\-]+)","coub":"coub\\.com\\\/view\\\/([a-zA-Z0-9_\\-]+)","odysee":"odysee\\.com\/\\$\/(?:embed|download)\/([-%_?=\/a-zA-Z0-9]+)","youku":"v\\.youku\\.com\/v_show\/id_([0-9A-Za-z=]+)\\.html","bilibili":"bilibili\\.com\\\/video\\\/(BV[0-9A-Za-z]+)","msoffice":"(?:office\\.com.*[&?]videoid=([a-z0-9\\-]+))","msstream":"microsoftstream\\.com\\\/video\\\/([a-f0-9\\-]{36})"}},"id":"opensim:banning_agents","namespace":"opensim","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script charset="utf-8" src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/jquery.php?tseed=34a552433bc33cc9c3bc32527289a0b2"></script>
<script charset="utf-8" src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/js.php?t=was&amp;tseed=24551d22639bdaeb736aec3dca86fd82&amp;template=was"></script>
<!--<![endif]-->
    <!-- <link rel="shortcut icon" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/favicon.ico" />
<link rel="apple-touch-icon" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/apple-touch-icon.png" />
 -->
    <!-- Viewport -->
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Favicon -->
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png?v=2">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png?v=2">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png?v=2">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png?v=2">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png?v=2">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png?v=2">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png?v=2">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png?v=2">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png?v=2">
<link rel="icon" type="image/png" href="/favicon-32x32.png?v=2" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png?v=2" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png?v=2" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png?v=2" sizes="16x16">
<link rel="manifest" href="/manifest.json?v=2">
<link rel="shortcut icon" href="/favicon.ico?v=2">
<meta name="apple-mobile-web-app-title" content="[Wizardry and Steamworks]">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png?v=2">
<meta name="application-name" content="[Wizardry and Steamworks]">
<meta name="theme-color" content="#ffffff">
    <!-- <script async type="text/javascript" src="/lib/tpl/was/loadCSS.js"></script>
    <script async type="text/javascript" src="/lib/tpl/was/cssrelpreload.js"></script> -->
</head>

<body>
    <!--[if lte IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_was     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header">

	    
	<!-- ********** TOP BAR ********** -->
	<div class="bar" id="bar__top">
		<div class="bar-left" id="bar__topleft">
			<form class="button btn_login" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="" /><button type="submit" title="Log In">Log In</button></div></form>						<form class="button btn_revs" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="revisions" /><button type="submit" accesskey="o" title="Revisions [O]">Revisions</button></div></form>						<form class="button btn_pdf" action="?do=export_pdf" method="POST">
			    <button type="submit" title="PDF">PDF</button>
                        </form>
		</div>
		<div class="bar-center">
		        <form class="button btn_home" action="/" method="POST">
                            <button type="submit" title="Home">Home</button>
                        </form>
			<form action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="opensim:banning_agents" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>			<!-- <form id="osssearchform" method="get" action="renderer">
        <input type="hidden" name="use" value="grimore.org">
        <input type="hidden" name="name" value="default">
        <input type="text" id="osssearchbox" name="query">
        <input type="hidden" name="login" value="search">
        <input type="hidden" name="key" value="1a5f74ab3f4df6ce883c4c158540e25e">
        <input type="submit" value="Search">
</form>
 -->
		</div>
		<div class="bar-right" id="bar__topright">
		        <form class="button btn_contact" action="mailto:%6F%66%66%69%63%65%40%67%72%69%6D%6F%72%65%2E%6F%72%67" method="POST">
			    <button type="submit" title="Contact">Contact</button>
                        </form>
                        <form class="button btn_news" action="/feed.php?type=rss2&amp;ns=opensim:banning_agents&amp;linkto=page&amp;content=abstract" method="POST">
			    <button type="submit" title="News">News</button>
                        </form>
			<form class="button btn_admin" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="admin" /><button type="submit" title="Admin">Admin</button></div></form>								</div>
			</div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" class="wikilink1" title="start" data-wiki-id="start">start</a></bdi></span> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim" class="wikilink1" title="opensim" data-wiki-id="opensim">opensim</a></bdi> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents" class="wikilink1" title="opensim:banning_agents" data-wiki-id="opensim:banning_agents">banning_agents</a></bdi></div>
                                </div>
    
    <hr class="a11y" />
</div><!-- /header -->

        <div class="wrapper group">

            <!--  -->

            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <!-- <div class="pageId"><span>opensim:banning_agents</span></div> -->

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#shortnote">Shortnote</a></div></li>
<li class="level1"><div class="li"><a href="#case_example">Case Example</a></div></li>
<li class="level1"><div class="li"><a href="#mac_addresses">MAC Addresses</a></div></li>
<li class="level1"><div class="li"><a href="#what_the_viewer_sends">What the Viewer Sends</a></div></li>
<li class="level1"><div class="li"><a href="#banning_on_the_network_layer">Banning on the Network Layer</a></div></li>
<li class="level1"><div class="li"><a href="#defeating_the_ban">Defeating the Ban</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="shortnote">Shortnote</h1>
<div class="level1">

<p>
In a hypergrid context, banning users is more difficult than on standalone grid because users may connect from different locations, use different viewers, have different IPs and use different network cards. The following guide offers a supplement to <a href="http://opensimulator.org/wiki/Banning_Foreign_Users_in_Hypergrid" class="urlextern" title="http://opensimulator.org/wiki/Banning_Foreign_Users_in_Hypergrid" rel="ugc nofollow">the  user-contributed guide</a>, that is able to track users more in-depth.
</p>

</div>

<h1 class="sectionedit2" id="case_example">Case Example</h1>
<div class="level1">

<p>
We have had a situation with an agent named <code>Jaine Mariolack</code> that visited our grids and started the usual grieving bullshit: rezzing physical balls, littering allover the place, etc...
</p>

<p>
So, we opened the <code>OpenSim.log</code> file to find out more information about the user. The agent connect string in the logs was the following:
</p>
<pre class="code">2013-02-24 06:05:08,657 INFO  - OpenSim.Services.HypergridService.GatekeeperService [GATEKEEPER SERVICE]: Login request for Jaine.Mariolack @virtualrealmsgrid.com @ http://virtualrealmsgrid.com:8002/ (0a009e79-7c56-11e2-b122-000c76240986) at VIBE using viewer Imprudence 1.3.2.0, channel Imprudence, IP 109.117.158.2, Mac d6812bb4d7625027d53c2e9715410caf, Id0 dd76693a887c545f4d65c2ff2da3a4d7 Teleport Flags 0</pre>

<p>
Looking up the IP address, it fell in the range of Vodafone IP addresses, looking it up yielded:
</p>
<pre class="code">inetnum:        109.116.0.0 - 109.117.255.255
netname:        VODAFONE-IT
descr:          IP addresses assigned to VF-IT mobile users
country:        IT
admin-c:        VI745-RIPE
tech-c:         VI745-RIPE
status:         ASSIGNED PA
mnt-by:         VODAFONE-IT-MNT
source:         RIPE # Filtered
</pre>

<p>
which is apparently a classic spammer case that uses a CDMA network in order to receive an IP every time in order to avoid bans. Thus, banning the IP address would be no good.
</p>

<p>
Indeed, we tracked down the IP addresses for this agent:
</p>
<pre class="code bash">opensim<span class="sy0">@</span>HornedOwl:~<span class="sy0">/</span>os<span class="sy0">/</span>bin$ <span class="kw2">cat</span> OpenSim.log  <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st_h">'Login request'</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st_h">'Jaine Mariolack'</span> <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-F</span> <span class="st_h">','</span> <span class="st_h">'{ print $4 }'</span>
 IP 109.112.128.89
 IP 109.112.80.6
 IP 109.112.80.6
 IP 109.117.158.2</pre>

</div>

<h1 class="sectionedit3" id="mac_addresses">MAC Addresses</h1>
<div class="level1">

<p>
Since the IP changes, the username may change, that leaves us with a possible MAC address ban. The problem is that the viewer sends a hashed version of the MAC address instead of the plain address.
</p>

<p>
Indeed, looking in<code>llstartup.cpp</code> of a V1.x viewer, we find the following logic:
</p>
<pre class="code C">    <span class="kw4">char</span> hashed_mac_string<span class="br0">&#91;</span>MD5HEX_STR_SIZE<span class="br0">&#93;</span><span class="sy0">;</span>    <span class="coMULTI">/* Flawfinder: ignore */</span>
    LLMD5 hashed_mac<span class="sy0">;</span>
    hashed_mac.<span class="me1">update</span><span class="br0">&#40;</span> gMACAddress<span class="sy0">,</span> MAC_ADDRESS_BYTES <span class="br0">&#41;</span><span class="sy0">;</span>
    hashed_mac.<span class="me1">finalize</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    hashed_mac.<span class="me1">hex_digest</span><span class="br0">&#40;</span>hashed_mac_string<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
which uses a hexdigest algorithm to hide the MAC address.
</p>

<p>
This is a problem, since the regular <code>iptables</code> package on Linux cannot filter out hashed MAC addresses.
</p>

<p>
However, this leaves us with the option of using the <code>ipt_string</code> matcher.
</p>

</div>

<h1 class="sectionedit4" id="what_the_viewer_sends">What the Viewer Sends</h1>
<div class="level1">

<p>
We performed a test in order to see what happens when a viewer connects to OpenSim and found the following XML / REST format.
</p>

<p>
First we listen to a port:
</p>
<pre class="code bash">nc <span class="re5">-l</span> <span class="nu0">9000</span></pre>

<p>
and we connect to the machine using a viewer. The resulting output is the following:
</p>
<pre class="code xml">POST / HTTP/1.1
Host: 192.168.2.9:9000
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: text/xml
Content-Length: 1905
Expect: 100-continue
&nbsp;
<span class="sc3"><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">&quot;1.0&quot;</span><span class="re2">?&gt;</span><span class="re1">&lt;methodCall<span class="re2">&gt;</span></span><span class="re1">&lt;methodName<span class="re2">&gt;</span></span></span>login_to_simulator<span class="sc3"><span class="re1">&lt;/methodName<span class="re2">&gt;</span></span><span class="re1">&lt;params<span class="re2">&gt;</span></span><span class="re1">&lt;param<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;struct<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>first<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Kira<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>last<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Komarov<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>passwd<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>$1$0113b43f53411d223b56ba3cc250a9a1<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>start<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>last<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>version<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Imprudence 1.4.0 Experimental 2010.10.23 / Second Life 1.23.5.136262<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>channel<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Imprudence<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>platform<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Mac<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>mac<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>7736ec1cc78c0f055addef6ac6506728<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>id0<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>52f6ecd06f322b6ee19f6aa2ffde3797<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>last_exec_event<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;int<span class="re2">&gt;</span></span></span>0<span class="sc3"><span class="re1">&lt;/int<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;member<span class="re2">&gt;</span></span><span class="re1">&lt;name<span class="re2">&gt;</span></span></span>options<span class="sc3"><span class="re1">&lt;/name<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;array<span class="re2">&gt;</span></span><span class="re1">&lt;data<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>inventory-root<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>inventory-skeleton<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>inventory-lib-root<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>inventory-lib-owner<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>inventory-skel-lib<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>initial-outfit<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>gestures<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>event_categories<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>event_notifications<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>classified_categories<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>adult_compliant<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>buddy-list<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>ui-config<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>map-server-url<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>tutorial_setting<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>login-flags<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;value<span class="re2">&gt;</span></span><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>global-textures<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/data<span class="re2">&gt;</span></span><span class="re1">&lt;/array<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/member<span class="re2">&gt;</span></span><span class="re1">&lt;/struct<span class="re2">&gt;</span></span><span class="re1">&lt;/value<span class="re2">&gt;</span></span><span class="re1">&lt;/param<span class="re2">&gt;</span></span><span class="re1">&lt;/params<span class="re2">&gt;</span></span><span class="re1">&lt;/methodCall<span class="re2">&gt;</span></span></span></pre>

<p>
Which, aside from the password hash, gives us the following interesting XML nibble:
</p>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>Mac<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span></span>
...
<span class="sc3"><span class="re1">&lt;string<span class="re2">&gt;</span></span></span>7736ec1cc78c0f055addef6ac6506728<span class="sc3"><span class="re1">&lt;/string<span class="re2">&gt;</span></span></span></pre>

<p>
Which is the hashed MAC address that the viewer is sending.
</p>

</div>

<h1 class="sectionedit5" id="banning_on_the_network_layer">Banning on the Network Layer</h1>
<div class="level1">

<p>
Now going back to <code>Jaine Mariolack</code>, we can search the log for the MAC address:
</p>
<pre class="code bash">opensim<span class="sy0">@</span>HornedOwl:~<span class="sy0">/</span>os<span class="sy0">/</span>bin$ <span class="kw2">cat</span> OpenSim.log  <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st_h">'Login request'</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st_h">'Jaine.Mariolack'</span> <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-F</span> <span class="st_h">','</span> <span class="st_h">'{ print $5 }'</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-u</span>
 Mac d6812bb4d7625027d53c2e9715410caf</pre>

<p>
Now that we know what the viewer is sending, we can use <code>ipt_string</code> match to detect the MAC address and ban the agent:
</p>
<pre class="code bash">iptables <span class="re5">-A</span> INPUT <span class="re5">-m</span> string <span class="re5">--string</span> <span class="st_h">'d6812bb4d7625027d53c2e9715410caf'</span> <span class="re5">--algo</span> bm <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">9000</span> <span class="re5">-j</span> DROP</pre>

<p>
Not only that, but we can ban the user as well:
</p>
<pre class="code bash">iptables <span class="re5">-A</span> INPUT <span class="re5">-m</span> string <span class="re5">--string</span> <span class="st_h">'Jaine'</span> <span class="re5">--algo</span> bm <span class="re5">-m</span> string <span class="re5">--string</span> <span class="st_h">'Mariolack'</span> <span class="re5">--algo</span> bm <span class="re5">-p</span> tcp <span class="re5">--dport</span> <span class="nu0">9000</span> <span class="re5">-j</span> DROP</pre>

<p>
The result is that the viewer is not able to connect and will timout on the Login screen:
</p>

<p>
<a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/_detail/opensim/opensim_banning_agents.png?id=opensim%3Abanning_agents" class="media" title="opensim:opensim_banning_agents.png"><img src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/_media/opensim/opensim_banning_agents.png?w=512&amp;tok=3350f5" class="mediacenter" alt="" width="512" /></a>
</p>

</div>

<h1 class="sectionedit6" id="defeating_the_ban">Defeating the Ban</h1>
<div class="level1">

<p>
This ban can be defeated by changing the MAC address of the network card or, more easily, <a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/secondlife/modified_viewers/obfuscate_mac" class="wikilink1" title="secondlife:modified_viewers:obfuscate_mac" data-wiki-id="secondlife:modified_viewers:obfuscate_mac">by modifying the viewer to send a random hex string</a> every time it connects.
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <div class="docInfo"><bdi>opensim/banning_agents.txt</bdi> Â· Last modified: 2022/04/19 09:28 (external edit)</div>

            <!-- PAGE ACTIONS -->
            <!-- <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Revisions [O]"><span>Revisions</span></a></li><li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents?do=export_pdf"  class="action export_pdf" rel="nofollow" title="Export to PDF"><span>Export to PDF</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div>--><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer">
    <!-- <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div> -->

		<!-- BREADCRUMBS -->
					<div class="breadcrumbs">
									<div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" class="wikilink1" title="start" data-wiki-id="start">start</a></bdi></span> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim" class="wikilink1" title="opensim" data-wiki-id="opensim">opensim</a></bdi> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents" class="wikilink1" title="opensim:banning_agents" data-wiki-id="opensim:banning_agents">banning_agents</a></bdi></div>
											</div>
		
		<!-- ********** BOTTOM BAR ********** -->
		<div class="bar" id="bar__bottom">
		  <div class="bar-left" id="bar__bottomleft">
			<form class="button btn_login" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="" /><button type="submit" title="Log In">Log In</button></div></form>						<form class="button btn_revs" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="revisions" /><button type="submit" accesskey="o" title="Revisions [O]">Revisions</button></div></form>			                        <form class="button btn_pdf" action="?do=export_pdf" method="POST">
                            <button type="submit" title="PDF">PDF</button>
                        </form>
		  </div>
		  <div class="bar-center">
                        <form class="button btn_home" action="/" method="POST">
                            <button type="submit" title="Home">Home</button>
                        </form>
			<form action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="opensim:banning_agents" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>			<!-- <form id="osssearchform" method="get" action="renderer">
        <input type="hidden" name="use" value="grimore.org">
        <input type="hidden" name="name" value="default">
        <input type="text" id="osssearchbox" name="query">
        <input type="hidden" name="login" value="search">
        <input type="hidden" name="key" value="1a5f74ab3f4df6ce883c4c158540e25e">
        <input type="submit" value="Search">
</form>
 -->
		  </div>
		  <div class="bar-right" id="bar__bottomright">
                        <form class="button btn_contact" action="mailto:%6F%66%66%69%63%65%40%67%72%69%6D%6F%72%65%2E%6F%72%67" method="POST">
                            <button type="submit" title="Contact">Contact</button>
                        </form>
                        <form class="button btn_news" action="/feed.php?mode=recent&amp;type=rss" method="POST">
                            <button type="submit" title="News">News</button>
                        </form>
			<form class="button btn_admin" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/opensim/banning_agents"><div class="no"><input type="hidden" name="do" value="admin" /><button type="submit" title="Admin">Admin</button></div></form>								  </div>
		  		</div>

		
</div><!-- /footer -->

<div style="text-align: center;">
    <div style="display:inline-block;">
      <p>
        <a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion">
          <img src="/lib/tpl/was/images/button-tor.png" alt="Access website using Tor" />
        </a> 
        <a href="http://ioujrf2uwqairs7l3vyvqp7n2pia3x3wg5w5qtcqvg32zezuezza.b32.i2p/" />
          <img src="/lib/tpl/was/images/button-i2p.png" alt="Access website using i2p" />
        </a>
        <a href="http://pgp.grimore.org/" />
          <img src="/lib/tpl/was/images/button-pgp.png" alt="Wizardry and Steamworks PGP Key" />
        </a>
      </p>
    </div>
<!--    <div style="display:inline-block;">
      <p>
        <a href="http://ij4lpzuyyng6cc4jw5mxibcyjv4rx4uk6x5jijoduglkgjh7mmya.b32.i2p">
          <img src="/lib/tpl/was/images/button-i2p.png" alt="Access website using i2p" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="http://cydia.grimore.org/">
          <img src="/lib/tpl/was/images/button-cydia.png" alt="Wizardry and Steamworks Cydia Repository" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="http://debian.grimore.org/">
          <img src="/lib/tpl/was/images/button-debian.png" alt="Wizardry and Steamworks Debian Repository" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="/opt/pasteboard/" rel="external nofollow">
          <img src="/lib/tpl/was/images/button-live.png" alt="Live Pasteboard" />
        </a> 
      </p>
    </div> -->
    
<br/>

    <p>
      For the copyright, license, warranty and privacy terms for the usage of this website please see the <a
      href="/wiki:license">license</a>, <a href="/wiki:privacy">privacy</a>, <a
      href="/wiki:copyright">copyright</a>
      and the <a href="/wiki:plagiarism">plagiarism</a> pages.
    </p>
</div>
    </div></div><!-- /site -->

    <div class="no"><img src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/taskrunner.php?id=opensim%3Abanning_agents&amp;1657307936" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if lte IE 8 ]></div><![endif]-->
</body>
</html>
