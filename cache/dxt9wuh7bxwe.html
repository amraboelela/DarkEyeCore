<!DOCTYPE html>
<html lang="was" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>fuss:openssh [Wizardry and Steamworks]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="fuss,openssh"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/opensearch.php" title="Wizardry and Steamworks"/>
<link rel="start" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/"/>
<link rel="contents" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh?do=index" title="Sitemap"/>
<link rel="manifest" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Changes" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/feed.php?mode=list&amp;ns=fuss"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/_export/xhtml/fuss/openssh"/>
<link rel="canonical" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"/>
<link rel="stylesheet" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/css.php?t=was&amp;tseed=24551d22639bdaeb736aec3dca86fd82"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='fuss';var JSINFO = {"plugin_imagemap_mldummy":"http:\/\/3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion\/_media\/wiki\/dokuwiki-128.png","isadmin":0,"isauth":0,"plugin_pdfjs":{"hide_download_button":0},"plugins":{"vshare":{"youtube":"youtube\\.com\/.*[&?]v=([a-z0-9_\\-]+)","vimeo":"vimeo\\.com\\\/(\\d+)","slideshare":"slideshare.*id=(\\d+)","dailymotion":"dailymotion\\.com\/video\/([a-z0-9]+)","archiveorg":"archive\\.org\/(?:embed|details)\/([a-zA-Z0-9_\\-]+)","soundcloud":"soundcloud\\.com\/([\\w-]+\/[\\w-]+)","niconico":"nicovideo\\.jp\/watch\/(sm[0-9]+)","bitchute":"bitchute\\.com\\\/video\\\/([a-zA-Z0-9_\\-]+)","coub":"coub\\.com\\\/view\\\/([a-zA-Z0-9_\\-]+)","odysee":"odysee\\.com\/\\$\/(?:embed|download)\/([-%_?=\/a-zA-Z0-9]+)","youku":"v\\.youku\\.com\/v_show\/id_([0-9A-Za-z=]+)\\.html","bilibili":"bilibili\\.com\\\/video\\\/(BV[0-9A-Za-z]+)","msoffice":"(?:office\\.com.*[&?]videoid=([a-z0-9\\-]+))","msstream":"microsoftstream\\.com\\\/video\\\/([a-f0-9\\-]{36})"}},"id":"fuss:openssh","namespace":"fuss","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script charset="utf-8" src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/jquery.php?tseed=34a552433bc33cc9c3bc32527289a0b2"></script>
<script charset="utf-8" src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/js.php?t=was&amp;tseed=24551d22639bdaeb736aec3dca86fd82&amp;template=was"></script>
<!--<![endif]-->
    <!-- <link rel="shortcut icon" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/favicon.ico" />
<link rel="apple-touch-icon" href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/apple-touch-icon.png" />
 -->
    <!-- Viewport -->
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Favicon -->
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png?v=2">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png?v=2">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png?v=2">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png?v=2">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png?v=2">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png?v=2">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png?v=2">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png?v=2">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png?v=2">
<link rel="icon" type="image/png" href="/favicon-32x32.png?v=2" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png?v=2" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png?v=2" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png?v=2" sizes="16x16">
<link rel="manifest" href="/manifest.json?v=2">
<link rel="shortcut icon" href="/favicon.ico?v=2">
<meta name="apple-mobile-web-app-title" content="[Wizardry and Steamworks]">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png?v=2">
<meta name="application-name" content="[Wizardry and Steamworks]">
<meta name="theme-color" content="#ffffff">
    <!-- <script async type="text/javascript" src="/lib/tpl/was/loadCSS.js"></script>
    <script async type="text/javascript" src="/lib/tpl/was/cssrelpreload.js"></script> -->
</head>

<body>
    <!--[if lte IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_was     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header">

	    
	<!-- ********** TOP BAR ********** -->
	<div class="bar" id="bar__top">
		<div class="bar-left" id="bar__topleft">
			<form class="button btn_login" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="" /><button type="submit" title="Log In">Log In</button></div></form>						<form class="button btn_revs" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="revisions" /><button type="submit" accesskey="o" title="Revisions [O]">Revisions</button></div></form>						<form class="button btn_pdf" action="?do=export_pdf" method="POST">
			    <button type="submit" title="PDF">PDF</button>
                        </form>
		</div>
		<div class="bar-center">
		        <form class="button btn_home" action="/" method="POST">
                            <button type="submit" title="Home">Home</button>
                        </form>
			<form action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="fuss:openssh" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>			<!-- <form id="osssearchform" method="get" action="renderer">
        <input type="hidden" name="use" value="grimore.org">
        <input type="hidden" name="name" value="default">
        <input type="text" id="osssearchbox" name="query">
        <input type="hidden" name="login" value="search">
        <input type="hidden" name="key" value="1a5f74ab3f4df6ce883c4c158540e25e">
        <input type="submit" value="Search">
</form>
 -->
		</div>
		<div class="bar-right" id="bar__topright">
		        <form class="button btn_contact" action="mailto:%6F%66%66%69%63%65%40%67%72%69%6D%6F%72%65%2E%6F%72%67" method="POST">
			    <button type="submit" title="Contact">Contact</button>
                        </form>
                        <form class="button btn_news" action="/feed.php?type=rss2&amp;ns=fuss:openssh&amp;linkto=page&amp;content=abstract" method="POST">
			    <button type="submit" title="News">News</button>
                        </form>
			<form class="button btn_admin" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="admin" /><button type="submit" title="Admin">Admin</button></div></form>								</div>
			</div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                            <div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" class="wikilink1" title="start" data-wiki-id="start">start</a></bdi></span> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss" class="wikilink1" title="fuss" data-wiki-id="fuss">fuss</a></bdi> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh" class="wikilink1" title="fuss:openssh" data-wiki-id="fuss:openssh">openssh</a></bdi></div>
                                </div>
    
    <hr class="a11y" />
</div><!-- /header -->

        <div class="wrapper group">

            <!--  -->

            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <!-- <div class="pageId"><span>fuss:openssh</span></div> -->

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#remove_duplicate_keys">Remove Duplicate Keys</a></div></li>
<li class="level1"><div class="li"><a href="#generate_public_key">Generate Public Key</a></div></li>
<li class="level1"><div class="li"><a href="#speeding-up_ssh_startup">Speeding-Up SSH Startup</a></div></li>
<li class="level1"><div class="li"><a href="#better_responsiveness_and_speed-up">Better Responsiveness and Speed-up</a></div></li>
<li class="level1"><div class="li"><a href="#restrict_sshd_users">Restrict SSHd Users</a></div></li>
<li class="level1"><div class="li"><a href="#tunneling">Tunneling</a></div></li>
<li class="level1"><div class="li"><a href="#copying_file_path_with_special_characters">Copying File Path with Special Characters</a></div></li>
<li class="level1"><div class="li"><a href="#restrict_users_to_sftp_only_instead_of_ssh">Restrict Users to SFTP only Instead of SSH</a></div></li>
<li class="level1"><div class="li"><a href="#enabling_diffie-hellman-group-sha1_key_exchange">Enabling Diffie-Hellman-Group-SHA1 Key Exchange</a></div></li>
<li class="level1"><div class="li"><a href="#fixing_various_network_issues">Fixing Various Network Issues</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="remove_duplicate_keys">Remove Duplicate Keys</h1>
<div class="level1">

<p>
Sometimes when <code>IP</code> addresses change or servers get moved around the <code>known_hosts</code> file in the <code>.ssh</code> hidden directory gets updated with two keys for the same <code>IP</code>. In that case, when you try to <code>ssh</code> to the sever again, you get a message about an offending key:
</p>
<pre class="code">Warning: the ECDSA host key for &#039;server.com&#039; differs from the key for the IP address &#039;118.82.143.119&#039;
Offending key for IP in /home/debian/.ssh/known_hosts:30
Matching host key in /home/debian/.ssh/known_hosts:38
Are you sure you want to continue connecting (yes/no)?
</pre>

<p>
The offending key can be removed easily using <code>sed</code>:
</p>
<pre class="code bash"><span class="kw2">sed</span> <span class="re5">-i</span> 30d <span class="sy0">/</span>home<span class="sy0">/</span>debian<span class="sy0">/</span>.ssh<span class="sy0">/</span>known_hosts</pre>

<p>
which deletes line <code>30</code> from the <code>known_hosts</code> file.
</p>

</div>

<h1 class="sectionedit2" id="generate_public_key">Generate Public Key</h1>
<div class="level1">

<p>
For <code>rsa</code>:
</p>
<pre class="code bash"><span class="kw2">ssh-keygen</span> <span class="re5">-t</span> rsa</pre>

<p>
For <code>dsa</code>:
</p>
<pre class="code bash"><span class="kw2">ssh-keygen</span> <span class="re5">-t</span> dsa</pre>

</div>

<h1 class="sectionedit3" id="speeding-up_ssh_startup">Speeding-Up SSH Startup</h1>
<div class="level1">

<p>
As pointed out by <a href="http://joshenders.com" class="urlextern" title="http://joshenders.com" rel="ugc nofollow">Josh Enders</a>, <code>ssh</code> on OSX performs a series of calls to <code>close</code> triggered by:
</p>
<pre class="code c">closefrom<span class="br0">&#40;</span>STDERR_FILENO <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
This can be checked with <code>dtruss</code>:
</p>
<pre class="code bash"><span class="co4">sh-3.2# </span>dtruss <span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw2">ssh</span>
<span class="co0"># ...</span>
stat64<span class="br0">&#40;</span><span class="st0">&quot;/usr/lib/system/libcorecrypto.dylib\0&quot;</span>, 0x7FFF570D4828, 0x1<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
getpid<span class="br0">&#40;</span>0x7FFF925948F8, 0x7FFF570D48B8, 0x1<span class="br0">&#41;</span>		 = <span class="nu0">79341</span> <span class="nu0">0</span>
close<span class="br0">&#40;</span>0x7DE<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7DF<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E0<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E1<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E2<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E3<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E4<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E5<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E6<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E7<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E8<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7E9<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7EA<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7EB<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7EC<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7ED<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7EE<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7EF<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7F0<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
close<span class="br0">&#40;</span>0x7F1<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#9</span>
&nbsp;</pre>

<p>
From the <code>ssh.c</code> <a href="http://www.opensource.apple.com/source/OpenSSH/OpenSSH-189/openssh/ssh.c" class="urlextern" title="http://www.opensource.apple.com/source/OpenSSH/OpenSSH-189/openssh/ssh.c" rel="ugc nofollow">source-file</a>, this function is called in <code>main</code> at the following code-segment:
</p>
<pre class="code c">	__progname <span class="sy0">=</span> ssh_get_progname<span class="br0">&#40;</span>av<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co2">#ifndef HAVE_SETPROCTITLE</span>
	<span class="coMULTI">/* Prepare for later setproctitle emulation */</span>
	<span class="coMULTI">/* Save argv so it isn't clobbered by setproctitle() emulation */</span>
	saved_av <span class="sy0">=</span> xcalloc<span class="br0">&#40;</span>ac <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="kw4">sizeof</span><span class="br0">&#40;</span><span class="sy0">*</span>saved_av<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> ac<span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span>
		saved_av<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> xstrdup<span class="br0">&#40;</span>av<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	saved_av<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> NULL<span class="sy0">;</span>
	compat_init_setproctitle<span class="br0">&#40;</span>ac<span class="sy0">,</span> av<span class="br0">&#41;</span><span class="sy0">;</span>
	av <span class="sy0">=</span> saved_av<span class="sy0">;</span>
<span class="co2">#endif</span>
&nbsp;
	<span class="coMULTI">/*
	 * Discard other fds that are hanging around. These can cause problem
	 * with backgrounded ssh processes started by ControlPersist.
	 */</span>
	closefrom<span class="br0">&#40;</span>STDERR_FILENO <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="coMULTI">/*
	 * Save the original real uid.  It will be needed later (uid-swapping
	 * may clobber the real uid).
	 */</span>
	original_real_uid <span class="sy0">=</span> getuid<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	original_effective_uid <span class="sy0">=</span> geteuid<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
The <code>closeform</code> function can be <code>nop</code>-ed out using a disassembler:
</p>
<pre class="code asm"><span class="co2">00000001</span>0000d792 BF03000000                      <span class="kw1">mov</span>        <span class="kw4">edi</span><span class="sy1">,</span> <span class="nu0">0x3</span>
<span class="co1">; nop closeform()</span>
<span class="co2">00000001</span>0000d797 E8D7510200                      <span class="kw1">call</span>       sub_100032973 
<span class="co2">00000001</span>0000d79c E8DD8E0400                      <span class="kw1">call</span>       imp___stubs__getuid</pre>

<p>
resulting in:
</p>
<pre class="code asm"><span class="co2">00000001</span>0000d792 BF03000000                      <span class="kw1">mov</span>        <span class="kw4">edi</span><span class="sy1">,</span> <span class="nu0">0x3</span>
<span class="co2">00000001</span>0000d797 <span class="nu0">90</span>                              <span class="kw1">nop</span>        
<span class="co2">00000001</span>0000d798 <span class="nu0">90</span>                              <span class="kw1">nop</span>        
<span class="co2">00000001</span>0000d799 <span class="nu0">90</span>                              <span class="kw1">nop</span>        
<span class="co2">00000001</span>0000d79a <span class="nu0">90</span>                              <span class="kw1">nop</span>        
<span class="co2">00000001</span>0000d79b <span class="nu0">90</span>                              <span class="kw1">nop</span>        
<span class="co2">00000001</span>0000d79c E8DD8E0400                      <span class="kw1">call</span>       imp___stubs__getuid</pre>

<p>
which avoids the <code>close</code> spam when <code>ssh</code> starts:
</p>
<pre class="code bash"><span class="co4">sh-3.2# </span>dtruss .<span class="sy0">/</span><span class="kw2">ssh</span>
<span class="co0"># ...</span>
open<span class="br0">&#40;</span><span class="st0">&quot;/dev/null\0&quot;</span>, 0x2, 0x7FFF551ECBC0<span class="br0">&#41;</span>		 = <span class="nu0">3</span> <span class="nu0">0</span>
close<span class="br0">&#40;</span>0x3<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
getuid<span class="br0">&#40;</span>0x3, 0x2, 0x7FFF551ECBC0<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
geteuid<span class="br0">&#40;</span>0x3, 0x2, 0x7FFF551ECBC0<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
seteuid<span class="br0">&#40;</span>0x0, 0x2, 0x7FFF551ECBC0<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
shm_open<span class="br0">&#40;</span>0x7FFF8475DCCA, 0x0, 0x0<span class="br0">&#41;</span>		 = <span class="nu0">3</span> <span class="nu0">0</span>
mmap<span class="br0">&#40;</span>0x0, 0x1000, 0x1, 0x1, 0x3, 0x0<span class="br0">&#41;</span>		 = 0x10AAE6000 <span class="nu0">0</span>
close_nocancel<span class="br0">&#40;</span>0x3<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
open_nocancel<span class="br0">&#40;</span><span class="st0">&quot;/etc/.mdns_debug\0&quot;</span>, 0x0, 0x0<span class="br0">&#41;</span>		 = <span class="re5">-1</span> Err<span class="co0">#2</span>
issetugid<span class="br0">&#40;</span>0x7FFF88B67E15, 0x0, 0x0<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span>
issetugid<span class="br0">&#40;</span>0x7FFF88B67E15, 0x0, 0x0<span class="br0">&#41;</span>		 = <span class="nu0">0</span> <span class="nu0">0</span></pre>

<p>
Or, on one line:
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">dd</span> <span class="re2">if</span>=<span class="sy0">&lt;</span><span class="br0">&#40;</span><span class="kw3">printf</span> <span class="st_h">'\x90\x90\x90\x90\x90'</span><span class="br0">&#41;</span> <span class="re2">of</span>=$<span class="br0">&#40;</span><span class="kw2">which</span> <span class="kw2">ssh</span><span class="br0">&#41;</span> <span class="re2">count</span>=<span class="nu0">5</span> <span class="re2">bs</span>=<span class="nu0">1</span> <span class="re2">seek</span>=<span class="nu0">59287</span> <span class="re2">conv</span>=notrunc</pre>

<p>
Note that this modification will most likely break <code>ControlMaster</code> and should not be used unless you are experiencing heavy slowdowns.
</p>

</div>

<h1 class="sectionedit4" id="better_responsiveness_and_speed-up">Better Responsiveness and Speed-up</h1>
<div class="level1">

<p>
The following settings will make <code>sshd</code> respond faster. They will:
</p>
<ul>
<li class="level1"><div class="li"> disable DNS lookups</div>
</li>
<li class="level1"><div class="li"> turn off compression</div>
</li>
<li class="level1"><div class="li"> restrict the ciphers and hashes to faster variants while still being backward-compatible.</div>
</li>
</ul>

<p>
Edit <code>/etc/ssh/sshd_config</code> and append the lines:
</p>
<pre class="code"># Server configuration
UseDNS no
compression no
ciphers arcfour,blowfish-cbc
macs hmac-md5-96
</pre>

<p>
On OSX, the client configuration should be changed in order to include <code>arcfour</code> and <code>blowfish-cbs</code> as cipher and <code>hmac-md5-96</code> as mac. In order to do that, open <code>/etc/ssh/ssh_config</code> and change the <code>Host *</code> directive:
</p>
<pre class="code">Host *
        SendEnv LANG LC_*
        compression no
        Ciphers arcfour,blowfish-cbc,aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
        MACs hmac-md5-96,hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160</pre>

</div>

<h1 class="sectionedit5" id="restrict_sshd_users">Restrict SSHd Users</h1>
<div class="level1">

<p>
Edit <code>/etc/ssh/sshd_config</code> and specify:
</p>
<pre class="code">PermitRootLogin no
AllowUsers merlin</pre>

<p>
where <code>merlin</code> is an username.
</p>

</div>

<h1 class="sectionedit6" id="tunneling">Tunneling</h1>
<div class="level1">

<p>
The following command:
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="re5">-f</span> jack<span class="sy0">@</span>home.internal <span class="re5">-L</span> <span class="nu0">2000</span>:home.internal:<span class="nu0">25</span> <span class="re5">-N</span></pre>

<p>
creates an SSH tunnel between the local machine that the command is run on and <code>home.internal</code> by forwarding the local <code>2000</code> port to the remote <code>25</code> port and without executing any command (<code>-N</code>).
</p>

<p>
The command can be broken down into the following options:
</p>
<ul>
<li class="level1"><div class="li"> <code>-f</code> tells <code>ssh</code> to background as soon as the connection to <code>home.internal</code> is established</div>
</li>
<li class="level1"><div class="li"> <code>jack@home.internal</code> is the user-name and remote machine to log-in to</div>
</li>
<li class="level1"><div class="li"> <code>-L 2000:home.internal:25</code> is the actual forwarding part that will forward the local <code>2000</code> port to the remote <code>25</code> port on <code>home.internal</code></div>
</li>
<li class="level1"><div class="li"> <code>-N</code> tells <code>ssh</code> to not execute an initial command</div>
</li>
</ul>

</div>

<h1 class="sectionedit7" id="copying_file_path_with_special_characters">Copying File Path with Special Characters</h1>
<div class="level1">

<p>
Sometimes one has to copy files that either contain special characters or the path to the file contains special characters. In such cases, you will find yourself experiencing either the dreaded error:
</p>
<pre class="code">scp: ambiguous target</pre>

<p>
in case <code>scp</code> did not like the target path, or the dreaded error:
</p>
<pre class="code">No such file or directory</pre>

<p>
In order to avoid that, both the source path and the target path must be escaped just that the target path must be double-escaped.
</p>

<p>
For example, suppose we wanted to send the file from the local machine:
</p>
<pre class="code">/Users/bravo/My Documents/phile.txt</pre>

<p>
to <code>johnny@192.168.0.1</code> with the path:
</p>
<pre class="code">/Backups/Phile Pholders/</pre>

<p>
We then have several methods of doing this:
</p>
<ul>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">scp</span> <span class="sy0">/</span>Users<span class="sy0">/</span>bravo<span class="sy0">/</span>My\ Documents<span class="sy0">/</span>phile.txt johnny<span class="sy0">@</span>192.168.0.1:<span class="st0">&quot;'/Backups/Phile Pholders/'&quot;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">scp</span> <span class="sy0">/</span>Users<span class="sy0">/</span>bravo<span class="sy0">/</span>My\ Documents<span class="sy0">/</span>phile.txt johnny<span class="sy0">@</span>192.168.0.1:<span class="st_h">'&quot;/Backups/Phile Pholders/&quot;'</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">scp</span> <span class="sy0">/</span>Users<span class="sy0">/</span>bravo<span class="sy0">/</span>My\ Documents<span class="sy0">/</span>phile.txt johnny<span class="sy0">@</span>192.168.0.1:<span class="st_h">'/Backups/Phile\ Pholders/'</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">scp</span> <span class="sy0">/</span>Users<span class="sy0">/</span>bravo<span class="sy0">/</span>My\ Documents<span class="sy0">/</span>phile.txt johnny<span class="sy0">@</span>192.168.0.1:<span class="st0">&quot;/Backups/Phile\ Pholders/&quot;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">scp</span> <span class="sy0">/</span>Users<span class="sy0">/</span>bravo<span class="sy0">/</span>My\ Documents<span class="sy0">/</span>phile.txt johnny<span class="sy0">@</span>192.168.0.1:<span class="sy0">/</span>Backups<span class="sy0">/</span>Phile\\\ Pholders<span class="sy0">/</span></pre>
</div>
</li>
</ul>

</div>

<h1 class="sectionedit8" id="restrict_users_to_sftp_only_instead_of_ssh">Restrict Users to SFTP only Instead of SSH</h1>
<div class="level1">

<p>
To restrict users or groups to use SFTP only without being able to log-in, first create a designated SFTP-only group:
</p>
<pre class="code bash">groupadd sftponly</pre>

<p>
and adding users to the <code>sftponly</code> group that should only have SFTP access, for instance, for user <code>john</code>:
</p>
<pre class="code bash">usermod <span class="re5">-g</span> <span class="kw2">users</span> <span class="re5">-G</span> <span class="kw2">users</span>,sftponly john</pre>

<p>
and then modifying <code>/etc/ssh/sshd_config</code>:
</p>
<pre class="code">Match group sftponly
	chrootDirectory /var/www
	ForceCommand internal-sftp
	AllowTcpForwarding no
	X11Forwarding no</pre>

<p>
where <code>/var/www</code> is a path to jail the users in the <code>sftponly</code> group to.
</p>

<p>
Finally, set the shell to <code>/usr/bin/nologin</code> for all users in the <code>sftponly</code> group:
</p>
<pre class="code bash">usermod <span class="re5">-s</span> <span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>nologin john</pre>

</div>

<h1 class="sectionedit9" id="enabling_diffie-hellman-group-sha1_key_exchange">Enabling Diffie-Hellman-Group-SHA1 Key Exchange</h1>
<div class="level1">

<p>
Some older hardware requires the <code>diffie-hellman-group1-sha1</code> key exchange in order to establish a successful SSH connection. Enabling the key exchange algorithm can be performed inline without having to change settings permanently:
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="re5">-oKexAlgorithms</span>=+diffie-hellman-group1-sha1 192.168.0.2</pre>

<p>
alternatively, edit <code>/etc/ssh/ssh_config</code> and adjust the parameters:
</p>
<pre class="code">Host 192.168.0.2
    KexAlgorithms +diffie-hellman-group1-sha1</pre>

</div>

<h1 class="sectionedit10" id="fixing_various_network_issues">Fixing Various Network Issues</h1>
<div class="level1">

<p>
Any of the following symptoms are to be detected?
</p>
<ul>
<li class="level1"><div class="li"> SSH connections drop,</div>
</li>
<li class="level1"><div class="li"> issuing commands with large output over SSH makes the SSH session hang</div>
</li>
</ul>

<p>
They may all boil down to a non-uniform MTU setting across the network. This problem typically shows up with IoT devices (including the Raspberry Pi) that have a trimmed down networking stack (either wireless or low end network devices) that do not allow setting the MTU past <code>9000</code>.
</p>

<p>
In case changing the MTU for the entire network is undesirable, then make sure that the settings:
</p>
<pre class="code">net.ipv4.ip_no_pmtu_disc = 1
net.ipv4.tcp_mtu_probing = 2</pre>

<p>
are set with <code>sysctl</code> on the device and on the gateway endpoint. Similarly, ICMP and IGMP should not be blocked across the network because the packets are crucial to negotiating packet transfers.
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <div class="docInfo"><bdi>fuss/openssh.txt</bdi> · Last modified: 2022/04/19 09:28 (external edit)</div>

            <!-- PAGE ACTIONS -->
            <!-- <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Revisions [O]"><span>Revisions</span></a></li><li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh?do=export_pdf"  class="action export_pdf" rel="nofollow" title="Export to PDF"><span>Export to PDF</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div>--><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer">
    <!-- <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/tpl/was/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div> -->

		<!-- BREADCRUMBS -->
					<div class="breadcrumbs">
									<div class="youarehere"><span class="bchead">You are here: </span><span class="home"><bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" class="wikilink1" title="start" data-wiki-id="start">start</a></bdi></span> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss" class="wikilink1" title="fuss" data-wiki-id="fuss">fuss</a></bdi> / <bdi><a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh" class="wikilink1" title="fuss:openssh" data-wiki-id="fuss:openssh">openssh</a></bdi></div>
											</div>
		
		<!-- ********** BOTTOM BAR ********** -->
		<div class="bar" id="bar__bottom">
		  <div class="bar-left" id="bar__bottomleft">
			<form class="button btn_login" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="" /><button type="submit" title="Log In">Log In</button></div></form>						<form class="button btn_revs" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="revisions" /><button type="submit" accesskey="o" title="Revisions [O]">Revisions</button></div></form>			                        <form class="button btn_pdf" action="?do=export_pdf" method="POST">
                            <button type="submit" title="PDF">PDF</button>
                        </form>
		  </div>
		  <div class="bar-center">
                        <form class="button btn_home" action="/" method="POST">
                            <button type="submit" title="Home">Home</button>
                        </form>
			<form action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="fuss:openssh" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>			<!-- <form id="osssearchform" method="get" action="renderer">
        <input type="hidden" name="use" value="grimore.org">
        <input type="hidden" name="name" value="default">
        <input type="text" id="osssearchbox" name="query">
        <input type="hidden" name="login" value="search">
        <input type="hidden" name="key" value="1a5f74ab3f4df6ce883c4c158540e25e">
        <input type="submit" value="Search">
</form>
 -->
		  </div>
		  <div class="bar-right" id="bar__bottomright">
                        <form class="button btn_contact" action="mailto:%6F%66%66%69%63%65%40%67%72%69%6D%6F%72%65%2E%6F%72%67" method="POST">
                            <button type="submit" title="Contact">Contact</button>
                        </form>
                        <form class="button btn_news" action="/feed.php?mode=recent&amp;type=rss" method="POST">
                            <button type="submit" title="News">News</button>
                        </form>
			<form class="button btn_admin" method="get" action="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/fuss/openssh"><div class="no"><input type="hidden" name="do" value="admin" /><button type="submit" title="Admin">Admin</button></div></form>								  </div>
		  		</div>

		
</div><!-- /footer -->

<div style="text-align: center;">
    <div style="display:inline-block;">
      <p>
        <a href="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion">
          <img src="/lib/tpl/was/images/button-tor.png" alt="Access website using Tor" />
        </a> 
        <a href="http://ioujrf2uwqairs7l3vyvqp7n2pia3x3wg5w5qtcqvg32zezuezza.b32.i2p/" />
          <img src="/lib/tpl/was/images/button-i2p.png" alt="Access website using i2p" />
        </a>
        <a href="http://pgp.grimore.org/" />
          <img src="/lib/tpl/was/images/button-pgp.png" alt="Wizardry and Steamworks PGP Key" />
        </a>
      </p>
    </div>
<!--    <div style="display:inline-block;">
      <p>
        <a href="http://ij4lpzuyyng6cc4jw5mxibcyjv4rx4uk6x5jijoduglkgjh7mmya.b32.i2p">
          <img src="/lib/tpl/was/images/button-i2p.png" alt="Access website using i2p" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="http://cydia.grimore.org/">
          <img src="/lib/tpl/was/images/button-cydia.png" alt="Wizardry and Steamworks Cydia Repository" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="http://debian.grimore.org/">
          <img src="/lib/tpl/was/images/button-debian.png" alt="Wizardry and Steamworks Debian Repository" />
        </a> 
      </p>
    </div>
    <div style="display:inline-block;">
      <p>
        <a href="/opt/pasteboard/" rel="external nofollow">
          <img src="/lib/tpl/was/images/button-live.png" alt="Live Pasteboard" />
        </a> 
      </p>
    </div> -->
    
<br/>

    <p>
      For the copyright, license, warranty and privacy terms for the usage of this website please see the <a
      href="/wiki:license">license</a>, <a href="/wiki:privacy">privacy</a>, <a
      href="/wiki:copyright">copyright</a>
      and the <a href="/wiki:plagiarism">plagiarism</a> pages.
    </p>
</div>
    </div></div><!-- /site -->

    <div class="no"><img src="http://3wymlmcsvxiaqzmbepsdawqpk6o2qsk65jhms72qqjulk5u4bgmvs3qd.onion/lib/exe/taskrunner.php?id=fuss%3Aopenssh&amp;1657305800" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if lte IE 8 ]></div><![endif]-->
</body>
</html>
